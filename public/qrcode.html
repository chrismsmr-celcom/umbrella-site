<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Générateur QR Code Umbrella</title>
<style>
body { font-family: Arial, sans-serif; text-align:center; background:#f7f7f7; padding:50px; }
input, select, button { padding:10px; margin:5px; font-size:16px; border-radius:6px; border:1px solid #ccc; width:300px; max-width:90%; }
button { background:#007bff; color:white; border:none; cursor:pointer; }
button:hover { background:#0056b3; }
#qrResult { margin-top:20px; border:1px solid #ccc; }
</style>
</head>
<body>

<h1>Générateur QR Code Umbrella</h1>

<select id="typeSelect">
  <option value="text">Texte / URL</option>
  <option value="file">Fichier (PDF / Image)</option>
</select>
<br>
<input type="text" id="qrInput" placeholder="Entrez texte ou URL">
<input type="file" id="fileInput" style="display:none;">
<br>
<label>Couleur QR</label>
<input type="color" id="colorInput" value="#000000">
<br>
<label>Taille QR (px)</label>
<input type="number" id="sizeInput" value="400" min="100" max="1000">
<br>
<button onclick="generateQRCode()">Générer QR Code</button>
<button onclick="downloadQRCode()" id="downloadBtn" style="display:none;">Télécharger QR</button>
<br>
<img id="qrResult" width="400" height="400">

<script>
const typeSelect = document.getElementById("typeSelect");
const qrInput = document.getElementById("qrInput");
const fileInput = document.getElementById("fileInput");
const qrResult = document.getElementById("qrResult");
const downloadBtn = document.getElementById("downloadBtn");
const colorInput = document.getElementById("colorInput");
const sizeInput = document.getElementById("sizeInput");

// Switch entre texte et fichier
typeSelect.addEventListener("change", () => {
    if(typeSelect.value === "file"){
        fileInput.style.display = "block";
        qrInput.style.display = "none";
    } else {
        fileInput.style.display = "none";
        qrInput.style.display = "block";
    }
});

async function generateQRCode(){
    let fileBase64 = null;
    if(typeSelect.value === "file" && fileInput.files[0]){
        const reader = new FileReader();
        fileBase64 = await new Promise(resolve => {
            reader.onload = () => resolve(reader.result);
            reader.readAsDataURL(fileInput.files[0]);
        });
    }

    const bodyData = {
        text: typeSelect.value === "text" ? qrInput.value.trim() : null,
        file: fileBase64,
        color: colorInput.value,
        size: parseInt(sizeInput.value)
    };

    if(!bodyData.text && !bodyData.file){
        alert("Entrez du texte ou choisissez un fichier");
        return;
    }

    try {
        const res = await fetch("https://umbrella-site-qr-code.onrender.com", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify(bodyData)
});

        const data = await res.json();
        qrResult.src = data.qr;
        downloadBtn.style.display = "inline-block";
    } catch(err){
        alert("Erreur génération QR : " + err.message);
    }
}

function downloadQRCode(){
    const a = document.createElement("a");
    a.href = qrResult.src;
    a.download = "qr_code.png";
    a.click();
}
</script>

</body>
</html>

