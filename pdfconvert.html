<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Umbrella PDF Engine v2</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #311038;
            --accent: #F0D13C;
            --bg: #f5f5fa;
        }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; display: flex; height: 100vh; background: var(--bg); }

        /* Sidebar */
        .sidebar { width: 300px; background: #FFF; box-shadow: 2px 0 10px rgba(0,0,0,0.1); display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; }
        .logo { width: 150px; margin: 0 auto 20px; display: block; }
        .sidebar h2 { text-align: center; color: var(--primary); font-size: 1.1rem; margin-bottom: 20px; border-bottom: 2px solid var(--bg); padding-bottom: 10px; }
        
        .action-group { margin-bottom: 20px; }
        .action-group label { font-size: 0.8rem; color: #888; text-transform: uppercase; font-weight: bold; margin-left: 5px; }
        
        .action-select button {
            padding: 12px; margin-top: 5px; width: 100%; border: none; border-radius: 8px;
            background: #f8f9fa; color: var(--primary); font-size: 14px; font-weight: 600;
            cursor: pointer; text-align: left; transition: all 0.2s; display: flex; align-items: center;
        }
        .action-select button i { margin-right: 12px; width: 20px; text-align: center; }
        .action-select button.active { background: var(--primary); color: white; }
        .action-select button:hover:not(.active) { background: #eee; }

        .download-btn {
            margin-top: auto; padding: 15px; width: 100%; background: var(--primary);
            color: var(--accent); border: none; border-radius: 8px; cursor: pointer;
            font-weight: bold; font-size: 16px;
        }
        .download-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        /* Main Area */
        .workarea { flex: 1; display: flex; align-items: center; justify-content: center; padding: 40px; }
        .dropzone {
            width: 100%; max-width: 600px; padding: 50px; border: 3px dashed var(--primary);
            border-radius: 20px; text-align: center; background: #fff; cursor: pointer;
        }
        .dropzone.dragover { background: #f0ebf2; border-color: var(--accent); }
        #fileInput { display: none; }
        .file-list { margin-top: 20px; text-align: left; font-size: 0.9rem; color: #555; }
    </style>
</head>
<body>

<div class="sidebar">
    <img src="https://i.postimg.cc/MGXwDDmH/Moniteo-removebg-preview.png" alt="Logo" class="logo">
    <h2>ENGINE v2.0</h2>
    
    <div class="action-group">
        <label>Depuis PDF</label>
        <div class="action-select">
            <button class="active" onclick="setAction('convert/pdf-to-word', this)"><i class="fa fa-file-word"></i> PDF → Word</button>
            <button onclick="setAction('convert/pdf-to-images', this)"><i class="fa fa-file-image"></i> PDF → Images</button>
            <button onclick="setAction('convert/pdf-to-excel', this)"><i class="fa fa-file-excel"></i> PDF → Excel</button>
        </div>
    </div>

    <div class="action-group">
        <label>Vers PDF</label>
        <div class="action-select">
            <button onclick="setAction('convert/office-to-pdf', this)"><i class="fa fa-file-powerpoint"></i> Office → PDF</button>
            <button onclick="setAction('convert/images-to-pdf', this)"><i class="fa fa-camera"></i> Images → PDF</button>
        </div>
    </div>

    <button id="downloadBtn" class="download-btn">Lancer la conversion</button>
</div>

<div class="workarea">
    <div class="dropzone" id="dropzone">
        <i class="fa fa-upload" style="font-size: 40px; color: var(--primary); margin-bottom: 15px;"></i>
        <p id="dropzone-text">Cliquez ou glissez vos fichiers ici</p>
        <input type="file" id="fileInput" multiple />
        <div class="file-list" id="fileList"></div>
    </div>
</div>

<script>
    let currentRoute = 'convert/pdf-to-word';
    let selectedFiles = [];

    function setAction(route, btn) {
        currentRoute = route;
        document.querySelectorAll('.action-select button').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        // Ajuster l'acceptation des fichiers selon la route
        const input = document.getElementById('fileInput');
        if(route.includes('office')) input.accept = ".docx,.xlsx,.pptx";
        else if(route.includes('images-to-pdf')) input.accept = ".jpg,.jpeg,.png";
        else input.accept = ".pdf";
    }

    const dropzone = document.getElementById('dropzone');
    const fileInput = document.getElementById('fileInput');
    const fileList = document.getElementById('fileList');
    const downloadBtn = document.getElementById('downloadBtn');

    dropzone.onclick = () => fileInput.click();

    fileInput.onchange = (e) => handleFiles(e.target.files);

    function handleFiles(files) {
        selectedFiles = Array.from(files);
        fileList.innerHTML = selectedFiles.map(f => `<div><i class="fa fa-check"></i> ${f.name}</div>`).join('');
    }

    downloadBtn.onclick = async () => {
        if (selectedFiles.length === 0) return alert("Sélectionnez des fichiers !");
        
        downloadBtn.disabled = true;
        downloadBtn.textContent = "Traitement en cours...";

        const formData = new FormData();
        selectedFiles.forEach(f => formData.append('files', f));

        try {
            const response = await fetch(`https://umbrella-site-qr-code.onrender.com/${currentRoute}`, {
                method: 'POST',
                body: formData
            });

            if (!response.ok) throw new Error("Erreur de conversion");

            const blob = await response.blob();
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = "Umbrella_Converted.zip";
            a.click();
            alert("Terminé !");
        } catch (err) {
            alert("Erreur serveur : Vérifiez que le Docker est bien déployé.");
        } finally {
            downloadBtn.disabled = false;
            downloadBtn.textContent = "Lancer la conversion";
        }
    };
</script>

</body>
</html>
