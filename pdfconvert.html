<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PDF Converter</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  display: flex; /* row par défaut */
  height: 100vh;
  background: #f5f5fa;
}

/* Sidebar */
.sidebar {
  width: 280px;
  background: #FFF;
  color: #fff;
  display: flex;
  flex-direction: column;
  padding: 20px;
  flex-shrink: 0;
  align-items: center;
}
.sidebar img.logo {
  width: 150px;
  margin-bottom: 20px;
}
.sidebar h2 {
  text-align: center;
  margin-bottom: 20px;
}
.action-select button {
  padding: 12px;
  margin-bottom: 10px;
  width: 100%;
  border: none;
  background: #311038;
  color: white;
  font-size: 16px;
  cursor: pointer;
}
.action-select button:hover {
  background: #003f8a;
}
.download-btn {
  margin-top:450px;
  padding: 12px;
  width: 100%;
  background: #311038;
  color: #F0D13C;
  border: none;
  cursor: pointer;
  font-weight: bold;
}
.download-btn:hover {
  background: #003f8a;
}

/* Workarea */
.workarea {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
}

/* Dropzone */
.dropzone {
  width: 100%;
  max-width: 600px;
  padding: 40px;
  border: 3px dashed #311038;
  border-radius: 12px;
  text-align: center;
  background: #fff;
  cursor: pointer;
  transition: background 0.2s, border-color 0.2s;
}
.dropzone.dragover {
  background: #e0f0ff;
  border-color: #0056c1;
}
.dropzone p {
  margin: 0;
  font-size: 18px;
  color: #311038;
}
.uploaded-file {
  margin-top: 10px;
  font-weight: bold;
  color: #311038;
}
</style>
</head>
<body>

<!-- Sidebar -->
<div class="sidebar">
  <!-- Logo -->
  <img src="https://i.postimg.cc/MGXwDDmH/Moniteo-removebg-preview.png" alt="Logo" class="logo">
  <h2>Convertisseur</h2>
  <div class="action-select">
    <button onclick="setAction('pdf2word')"><i class="fa fa-file-pdf"></i> PDF → Word</button>
    <button onclick="setAction('pdf2image')"><i class="fa fa-file-image"></i> PDF → Image</button>
  </div>
  <button id="downloadBtn" class="download-btn">Télécharger / Convertir</button>
</div>

<!-- Workarea -->
<div class="workarea">
  <div class="dropzone" id="dropzone">
    <p>Glissez vos fichiers ici ou cliquez pour sélectionner</p>
    <input type="file" id="fileInput" multiple accept=".pdf" />
    <div class="uploaded-file" id="uploadedFile"></div>
  </div>
</div>

<script>
let currentAction = 'pdf2word';
let uploadedFiles = [];

function setAction(action) {
  currentAction = action;
}

// Drag & Drop
const dropzone = document.getElementById('dropzone');
const fileInput = document.getElementById('fileInput');
const uploadedFileDiv = document.getElementById('uploadedFile');
const downloadBtn = document.getElementById('downloadBtn');

dropzone.addEventListener('click', () => fileInput.click());

dropzone.addEventListener('dragover', e => {
  e.preventDefault();
  dropzone.classList.add('dragover');
});
dropzone.addEventListener('dragleave', e => {
  e.preventDefault();
  dropzone.classList.remove('dragover');
});
dropzone.addEventListener('drop', e => {
  e.preventDefault();
  dropzone.classList.remove('dragover');
  handleFiles(e.dataTransfer.files);
});

fileInput.addEventListener('change', e => {
  handleFiles(e.target.files);
});

function handleFiles(files) {
  if (!files || files.length === 0) return;
  uploadedFiles = Array.from(files);
  uploadedFileDiv.innerHTML = uploadedFiles.map(f => f.name).join('<br>');
}

// Convertir & télécharger ZIP
downloadBtn.addEventListener('click', async () => {
  if (uploadedFiles.length === 0) {
    alert('Veuillez sélectionner au moins un fichier PDF.');
    return;
  }

  const formData = new FormData();
  uploadedFiles.forEach(f => formData.append('files', f));

  try {
    const res = await fetch(`https://umbrella-site-qr-code.onrender.com/${currentAction}`, {
      method: 'POST',
      body: formData
    });
    if (!res.ok) throw new Error(`Erreur serveur: ${res.statusText}`);

    const blob = await res.blob();
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = currentAction === 'pdf2word' ? 'converted_word_files.zip' : 'pdf_images.zip';
    document.body.appendChild(a);
    a.click();
    a.remove();
  } catch (err) {
    alert('Erreur lors de la conversion: ' + err.message);
  }
});
</script>

</body>
</html>

