<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Umbrella Converter</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  display: flex;
  height: 100vh;
  background: #f5f5fa;
}

/* Sidebar */
.sidebar {
  width: 280px;
  background: #0070F6;
  color: #fff;
  padding: 20px;
}

.sidebar button {
  width: 100%;
  margin-bottom: 10px;
  padding: 10px;
  border: none;
  background: #fff;
  color: #0070F6;
  font-weight: bold;
  cursor: pointer;
  border-radius: 6px;
}

/* Workarea */
.workarea {
  flex: 1;
  display: flex;
  justify-content: center;
  align-items: center;
}

/* Dropzone */
.dropzone {
  width: 100%;
  max-width: 500px;
  padding: 40px;
  border: 3px dashed #0070F6;
  border-radius: 12px;
  background: #fff;
  text-align: center;
  cursor: pointer;
}

.dropzone.dragover {
  background: #e6f2ff;
}

#convertBtn {
  margin-top: 20px;
  padding: 12px 20px;
  font-size: 16px;
  background: #0070F6;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
}
</style>
</head>

<body>

<div class="sidebar">
  <h3>Convertisseur</h3>
  <button onclick="setAction('pdf2word')">PDF → Word</button>
  <button onclick="setAction('image2pdf')">Image → PDF</button>
</div>

<div class="workarea">
  <div>
    <div class="dropzone" id="dropzone">
      <p id="dropText">Cliquez ou glissez un fichier</p>
      <input type="file" id="fileInput" hidden />
    </div>
    <button id="convertBtn">Convertir & Télécharger</button>
  </div>
</div>

<script>
const API_URL = "https://umbrella-site-qr-code.onrender.com";
let selectedFile = null;
let action = "pdf2word";

function setAction(a) {
  action = a;
  document.getElementById("dropText").textContent =
    a === "pdf2word" ? "Déposez un PDF" : "Déposez une image";
}

const dropzone = document.getElementById("dropzone");
const fileInput = document.getElementById("fileInput");

dropzone.onclick = () => fileInput.click();

fileInput.onchange = e => {
  selectedFile = e.target.files[0];
  dropzone.querySelector("p").textContent = selectedFile.name;
};

dropzone.ondragover = e => {
  e.preventDefault();
  dropzone.classList.add("dragover");
};

dropzone.ondragleave = () => dropzone.classList.remove("dragover");

dropzone.ondrop = e => {
  e.preventDefault();
  dropzone.classList.remove("dragover");
  selectedFile = e.dataTransfer.files[0];
  dropzone.querySelector("p").textContent = selectedFile.name;
};

document.getElementById("convertBtn").onclick = async () => {
  if (!selectedFile) {
    alert("Veuillez sélectionner un fichier");
    return;
  }

  const formData = new FormData();
  formData.append("file", selectedFile);

  try {
    const response = await fetch(`${API_URL}/${action}`, {
      method: "POST",
      body: formData
    });

    if (!response.ok) throw new Error("Erreur serveur");

    const blob = await response.blob();
    const url = window.URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = selectedFile.name;
    a.click();

  } catch (err) {
    alert("Erreur lors de la conversion");
    console.error(err);
  }
};
</script>

</body>
</html>
