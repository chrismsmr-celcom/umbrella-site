<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PDF Converter</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  display: flex; /* row par défaut */
  height: 100vh;
  background: #f5f5fa;
}

/* Sidebar */
.sidebar {
  width: 280px;
  background: #0070F6;
  color: #fff;
  display: flex;
  flex-direction: column;
  padding: 20px;
  flex-shrink: 0;
}
.sidebar h2 {
  text-align: center;
  margin-bottom: 20px;
}
.action-select button {
  padding: 12px;
  margin-bottom: 10px;
  width: 100%;
  border: none;
  background: #0056c1;
  color: white;
  font-size: 16px;
  cursor: pointer;
}
.action-select button:hover {
  background: #003f8a;
}
.download-btn {
  margin-top: 20px;
  padding: 12px;
  background: #fff;
  color: #0070F6;
  border: none;
  cursor: pointer;
  font-weight: bold;
}

/* Workarea */
.workarea {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
}

/* Dropzone */
.dropzone {
  width: 100%;
  max-width: 600px;
  padding: 40px;
  border: 3px dashed #0070F6;
  border-radius: 12px;
  text-align: center;
  background: #fff;
  cursor: pointer;
  transition: background 0.2s, border-color 0.2s;
}
.dropzone.dragover {
  background: #e0f0ff;
  border-color: #0056c1;
}
.dropzone p {
  margin: 0;
  font-size: 18px;
  color: #0070F6;
}
.uploaded-file {
  margin-top: 10px;
  font-weight: bold;
  color: #0070F6;
}
</style>
</head>
<body>

<!-- Sidebar -->
<div class="sidebar">
  <h2>Convertisseur</h2>
  <div class="action-select">
    <button onclick="setAction('pdf2word')"><i class="fa fa-file-pdf"></i> PDF → Word</button>
    <button onclick="setAction('word2pdf')"><i class="fa fa-file-word"></i> Word → PDF</button>
    <button onclick="setAction('pdf2image')"><i class="fa fa-file-image"></i> PDF → Image</button>
    <button onclick="setAction('image2pdf')"><i class="fa fa-file-image"></i> Image → PDF</button>
  </div>
  <button id="downloadBtn" class="download-btn">Télécharger / Convertir</button>
</div>

<!-- Workarea -->
<div class="workarea">
  <div class="dropzone" id="dropzone">
    <p>Glissez votre fichier ici ou cliquez pour sélectionner</p>
    <input type="file" id="fileInput" />
    <div class="uploaded-file" id="uploadedFile"></div>
  </div>
</div>

<script>
let currentAction = 'pdf2word';
let uploadedFile = null;

function setAction(action) {
  currentAction = action;
  console.log('Action choisie:', action);
}

// Drag & Drop
const dropzone = document.getElementById('dropzone');
const fileInput = document.getElementById('fileInput');
const uploadedFileDiv = document.getElementById('uploadedFile');
const downloadBtn = document.getElementById('downloadBtn');

dropzone.addEventListener('click', () => fileInput.click());

dropzone.addEventListener('dragover', e => {
  e.preventDefault();
  dropzone.classList.add('dragover');
});
dropzone.addEventListener('dragleave', e => {
  e.preventDefault();
  dropzone.classList.remove('dragover');
});
dropzone.addEventListener('drop', e => {
  e.preventDefault();
  dropzone.classList.remove('dragover');
  const file = e.dataTransfer.files[0];
  handleFile(file);
});

fileInput.addEventListener('change', e => {
  const file = e.target.files[0];
  handleFile(file);
});

function handleFile(file) {
  if (!file) return;
  uploadedFile = file;
  uploadedFileDiv.textContent = file.name;
}

// Convertir & télécharger
downloadBtn.addEventListener('click', async () => {
  if (!uploadedFile) {
    alert('Veuillez sélectionner un fichier.');
    return;
  }

  const formData = new FormData();
  formData.append('file', uploadedFile);

  try {
    const res = await fetch(`https://umbrella-site-qr-code.onrender.com/${currentAction}`, {
      method: 'POST',
      body: formData
    });
    if (!res.ok) throw new Error(`Erreur serveur: ${res.statusText}`);
    const blob = await res.blob();
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = uploadedFile.name
      .replace(/\.[^/.]+$/, '')
      + getExtension(currentAction);
    document.body.appendChild(a);
    a.click();
    a.remove();
  } catch (err) {
    alert('Erreur lors de la conversion: ' + err.message);
  }
});

function getExtension(action) {
  switch(action) {
    case 'pdf2word': return '.docx';
    case 'word2pdf': return '.pdf';
    case 'pdf2image': return '.png';
    case 'image2pdf': return '.pdf';
    default: return '';
  }
}
</script>

</body>
</html>

